[toc]

项目依赖python环境，并且需要以下依赖:

- pandas
- xmltodict

# 1 基因生成工具
基因生成工具为： BatchFarCreate.py, 该工具可以通过命令行对指定文件夹里面的视频进行批量基因生成，并分析视频信息、far文件信息以及VDNAGen执行信息汇总生成报告。

## 1.1 命令参数说明

脚本包含如下命令参数: 

| 命令行参数           | 说明                                                         |
|-----------------| ------------------------------------------------------------ |
| \-i             | 不可省略，原视频路径，支持目录递归                           |
| \-o             | 不可省略，保存far文件目录，保存目录生成文件与原视频路径有相同的目录格式。 |
| \-\-num_workers | 可以省略， 工作线程数量，默认为: `线程数 = CPU线程数/1.5 + 1` |

## 1.2 使用示例

```shell
# 获得命令帮助信息
./BatchFarCreate.py -h
# 读取输入文件夹的视频，在保存far文件夹生成far文件，由系统自动确定线程数量
./BatchFarCreate.py -i 输入视频文件夹 -o 保存far文件夹
# 读取输入文件夹的视频，在保存far文件夹生成far文件,指明线程数量为40 
./BatchFarCreate.py -i 输入视频文件夹 -o 保存far文件目录 --num_workders=40 (指定线程数量)
```

## 1.3 输出说明

| 输出文件               | 说明                                                         |
| ---------------------- | ------------------------------------------------------------ |
| batch_far_create.log   | BatchFarCreate.py 脚本 执行过程中生成的日志                  |
| far_create_report.xlsx | BatchFarCreate.py 脚本 输出Excel报告，对于脚本中视频信息、far文件信息、命令执行时间的时间做了统计 |
| far_path_report.txt    | BatchFarCreate.py 脚本 生成的far文件路径，后去基因入库工具可以读取该文件进行基因入库 |

# 2 基因入库工具

基因入库工具为：BatchFarUpload.py, 该工具通过指定服务器地址、用户名、密码 以及包含far文件地址的文本文件，完成对指定的far文件进行批量基因入库。

## 2.1 命令行参数说明

脚本包含如下命令行参数:

| 命令行参数 | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| \-s        | 不可省略 VDDB服务器地址                                      |
| \-u        | 不可省略 VDDB用户名称                                        |
| \-p        | 不可省略 VDDB用户密码                                        |
| \-f         | 不可省略 文本文件 为BatchFarCreate.py生成的far_path_report.txt文本文件 |

## 2.2 使用示例

```shell
# 获取命令帮助信息
./BatchFarUpload.py -h
# far文件批量入库
./BatchFarUpload.py -s VDDB服务器地址 -u VDDB用户名 -p VDDB用户密码 -f far_path_report.txt
```

## 2.3 输出说明

该脚本不会输出报告，**在基因入库的同时，服务器会返回一个基因入库状态信息，为基因入库的唯一标识meta_uid**。

对于这些信息，BatFarUpload.py脚本会在far文件对应路径下生成一个 xxxx.far.result文件，该文件保存了基因入库的信息
**注意:** 如果该基因入库失败，则不会生成该文件，所以如果存在基因入库出错的情况，可以使用脚本进行重新入库，对应入库成功的脚本不会重新入库。

# 3 基因查询工具

基因查询脚本为：BatchFarMatch.py， 该脚本通过指定MediaWise服务地址、用户名、密码，以及查询的far文件夹，完成对指定文件夹中的far文件进行批量查询，并汇总输出查询报告。

## 3.1 命令行参数说明

| 命令行参数 | 说明                                             |
| ---------- | ------------------------------------------------ |
| \-s        | 不可省略 MediaWise服务地址                       |
| \-u         | 不可省略 MediaWise用户名称                       |
| \-p         | 不可省略 MediaWise用户密码                       |
| \-i        | 不可省略 far文件目录，如果包含多级目录，支持递归 |

## 3.2 使用示例

```shell
# 获取命令行帮助信息
./BatchFarMatch.py -h
# far文件批量查询
./BatchFarMatch.py -s MediaWise服务地址 -u  MediaWise用户名 -p MediaWise用户密码 -i far文件目录
```

## 3.3 输出说明

基因查询会输出查询Excel报告，该报告包含以下字段作为查询信息：

基因文件路径，查询开始时间，查询结束时间，查询返回代码，查询任务ID，匹配数量，匹配母本的标题，匹配母本的ID，样本的偏移量，母本的偏移量，匹配时长，匹配置信度

